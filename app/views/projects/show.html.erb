<p>项目名称:<%= @project.name %> </p>
<p>项目描述:<%= @project.description %> </p>
<% if can? :manage, @project %>
<%= form_tag(project_path, :method => "put")  do %>
    <%= label_tag(:new_mem,"增加新成员") %>
    <%= text_field_tag(:new_member) %>
    <%= hidden_field_tag(:project_id, params[:id]) if false %>
    <%= submit_tag("确定") %>
  <% end %>
<% end %>

<% if can? :manage, @project %>
<p>项目状况:</p>
<table border = "0">
  <tr>
    <th>成员</th>
    <th>待审</th>
    <th>拒绝</th>
    <th>同意</th>
    <th>总数</th>
  </tr>

  <% for member in @project.users %>
    <tr>
      <td><%= member.email %></td>
      <td><%= @number_of_pending %></td>
      <td><%= @number_of_declined %></td>
      <td><%= @number_of_approved %></td>
      <td><%= member.checkins.count %></td>
    </tr>
  <% end %>
</table>
<br />
<%end%>

<% if can?(:create, Checkin.new(:project => @project)) %>
  <%= Time.now %>
  <br />
  <%= button_to( "今日打卡", project_checkin_index_path(:project_id => @project.id )) %> 
  <br />
<% end %>

<table border="0">
  <tr> 
    <th>时间</th>
    <th>成员</th>
    <th>状态</th>
    <% if @admin %>
      <th>拒绝</th>
      <th>同意</th>
    <% end %>
  </tr>
<% @project.checkins.all.each do | checkin |%>
<tr>
  <td><%= checkin.created_at %></td>
  <td><%= checkin.user.email%></td>
  <td><%= checkin.state %></td>
  <% if @admin and checkin.state == "pending"%>
    <td><%= button_to "拒绝", project_checkin_path(:project_id => @project, :id => checkin, :state => "declined"), :method => :put  %> </td>
    <td><%= button_to "同意", project_checkin_path(:project_id => @project, :id => checkin, :state => "approved"), :method => :put  %> </td>
</tr>
<% end %>
<% end %>
</table>


<table border="0">
  <tr>
    <td><% if @time_last_month > @time_earlist_checkin%><%= link_to "上月",project_path(:id => @project, :year => @time_last_month.year, :month => @time_last_month.month, :user => @user) %><% end %></td>
    <td align="center"><%= @time.strftime("%Y/%m")%></td>
    <td colspan = "2" ><% if @time_next_month <= Time.now %><%= link_to "下月",project_path(:id => @project, :year => @time_next_month.year, :month => @time_next_month.month, :user => @user) %> <% end %></td>
  </tr>
  <tr>

    <tr>
      <th>时间</th>
      <th>状态</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
       <% for i in 1..@checkins_on_this_month.length-1 %>
      <tr>
        <td align="center"><%= i %></td>
          <% if @checkins_on_this_month[i] == "pending"%>
            <td bgcolor = "yellow"><%= " " * @state_width %></td>
          <% elsif @checkins_on_this_month[i] == "approved"%>
            <td bgcolor = "green"><%= " " * @state_width %></td>
          <% elsif @checkins_on_this_month[i] == "declined"%>
            <td bgcolor = "red"><%= " " * @state_width %></td>
          <% else %>
            <td bgcolor = "white"><%= " " * @state_width %></td>
          <% end %>
          
          <% if can?(:manage, @project) and @checkins_on_this_month[i] == "pending" %>
            <td><%= button_to "拒绝", project_checkin_path(:project_id => @project, :id => @checkin_on_day[i], :state => "declined"), :method => :put  %> </td>
            <td><%= button_to "同意", project_checkin_path(:project_id => @project, :id => @checkin_on_day[i], :state => "approved"), :method => :put  %> </td>
          <%end%>
      </tr>
    <% end %>
  </table>
